<!-- dashboard.component.html -->
<div class="kanban-container" *ngIf="isLoggedIn">

  <!-- User Selection Section (shown when no user is logged in) -->
  <div class="user-selector" *ngIf="showUserSelector">
    <h3>Select User to View Tasks</h3>
    <div class="user-list">
      <button 
        *ngFor="let employee of availableEmployees"
        class="user-select-btn"
        (click)="selectUser(employee)">
        {{ employee.ename }}
        <span *ngIf="employee.isAdmin" style="font-size: 12px; margin-left: 5px;">(Admin)</span>
      </button>
    </div>
  </div>

  <!-- Dashboard Content (shown when user is logged in) -->
  <div *ngIf="!showUserSelector && !isLoading">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h1>My Tasks Dashboard</h1>
      <p class="subtitle">Manage and track all your assigned tasks</p>
    </div>

    <!-- User Profile Section -->
    <div class="user-profile-section">
      <div class="current-user-info">
        <div class="user-initials">{{ getUserInitials(loggedInEmployee?.ename || '') }}</div>
        <div class="user-details">
          <h3>{{ loggedInEmployee?.ename }}</h3>
          <p>Employee ID: {{ loggedInEmployee?.eid }} â€¢ {{ getUserRole() }}</p>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>

    <!-- Kanban Headers -->
    <div class="kanban-headers">
      <div class="header">To Do ({{ taskStats.todo }})</div>
      <div class="header">In Progress ({{ taskStats.inProgress }})</div>
      <div class="header">Done ({{ taskStats.done }})</div>
    </div>

    <!-- Tasks Container -->
    <div class="tasks-container">
      <div class="task-columns">
        
        <!-- To Do Column -->
        <div class="task-column">
          <div *ngIf="userTasks.todo.length === 0" class="empty-state">
            No tasks to do
          </div>
          <div *ngFor="let task of userTasks.todo" class="task-card">
            <div *ngIf="task.activeYN" class="task-active-indicator">
              <span class="active-badge">Active</span>
            </div>
            <div class="task-header">
              <span class="task-id">{{ formatTaskId(task.taskId) }}</span>
              <span class="task-status" [ngClass]="getStatusClass(task.taskStatus)">
                {{ formatTaskStatus(task.taskStatus) }}
              </span>
            </div>
            <div class="task-title">{{ task.taskTitle }}</div>
            <div class="task-description">{{ task.taskDesc }}</div>
            <div class="task-meta">
              <div>
                <span class="meta-label">Sprint:</span>
                <span class="task-sprint">Sprint {{ task.sprintId }}</span>
              </div>
              <div>
                <span class="meta-label">Created:</span>
                <span class="task-created">{{ formatDate(task.createdAt) }}</span>
              </div>
              <div>
                <span class="meta-label">Assigned From:</span>
                <span class="task-assignment">{{ getEmployeeName(task.assignedFrom) }} (ID: {{ task.assignedFrom }})</span>
              </div>
            </div>
          </div>
        </div>

        <!-- In Progress Column -->
        <div class="task-column">
          <div *ngIf="userTasks.inProgress.length === 0" class="empty-state">
            No tasks in progress
          </div>
          <div *ngFor="let task of userTasks.inProgress" class="task-card">
            <div *ngIf="task.activeYN" class="task-active-indicator">
              <span class="active-badge">Active</span>
            </div>
            <div class="task-header">
              <span class="task-id">{{ formatTaskId(task.taskId) }}</span>
              <span class="task-status" [ngClass]="getStatusClass(task.taskStatus)">
                {{ formatTaskStatus(task.taskStatus) }}
              </span>
            </div>
            <div class="task-title">{{ task.taskTitle }}</div>
            <div class="task-description">{{ task.taskDesc }}</div>
            <div class="task-meta">
              <div>
                <span class="meta-label">Sprint:</span>
                <span class="task-sprint">Sprint {{ task.sprintId }}</span>
              </div>
              <div>
                <span class="meta-label">Created:</span>
                <span class="task-created">{{ formatDate(task.createdAt) }}</span>
              </div>
              <div>
                <span class="meta-label">Assigned From:</span>
                <span class="task-assignment">{{ getEmployeeName(task.assignedFrom) }} (ID: {{ task.assignedFrom }})</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Done Column -->
        <div class="task-column">
          <div *ngIf="userTasks.done.length === 0" class="empty-state">
            No completed tasks
          </div>
          <div *ngFor="let task of userTasks.done" class="task-card">
            <div *ngIf="task.activeYN" class="task-active-indicator">
              <span class="active-badge">Active</span>
            </div>
            <div class="task-header">
              <span class="task-id">{{ formatTaskId(task.taskId) }}</span>
              <span class="task-status" [ngClass]="getStatusClass(task.taskStatus)">
                {{ formatTaskStatus(task.taskStatus) }}
              </span>
            </div>
            <div class="task-title">{{ task.taskTitle }}</div>
            <div class="task-description">{{ task.taskDesc }}</div>
            <div class="task-meta">
              <div>
                <span class="meta-label">Sprint:</span>
                <span class="task-sprint">Sprint {{ task.sprintId }}</span>
              </div>
              <div>
                <span class="meta-label">Created:</span>
                <span class="task-created">{{ formatDate(task.createdAt) }}</span>
              </div>
              <div>
                <span class="meta-label">Assigned From:</span>
                <span class="task-assignment">{{ getEmployeeName(task.assignedFrom) }} (ID: {{ task.assignedFrom }})</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !showUserSelector" style="text-align: center; padding: 50px;">
    <div class="loading-spinner"></div>
    <p style="margin-top: 15px; color: #6c757d;">Loading your tasks...</p>
  </div>
</div>