<!-- backlog.component.html -->
<div class="backlog-container">
  <!-- Header -->
  <div class="header-section">
    <h1>Backlog</h1>
    <div class="header-actions">
      <div class="search-box">
        <input type="text" placeholder="Search tasks..." class="form-control">
      </div>
      <button class="btn btn-primary" (click)="createSprint()" (click)="isSprintModalOpen = true">
        <i class="fas fa-plus"></i>
        Create Sprint
      </button>
    </div>
  </div>

  <!-- Active Sprint Section -->
  <div class="sprint-container" *ngFor="let sprint of allSprints; let i = index">
    <!-- Sprint Header (Clickable) -->
    <div class="sprint-header" (click)="toggleSprint(i)" [class.expanded]="sprintExpanded[i]">
      <div class="sprint-toggle">
        <i class="fas" [class.fa-chevron-right]="!sprintExpanded[i]" [class.fa-chevron-down]="sprintExpanded[i]"></i>
      </div>
      
      <div class="sprint-info">
        <div class="sprint-title-row">
          <h4 class="sprint-title">{{ sprint.sprintTitle }}</h4>
          <div class="sprint-status-badge">
            <span class="status-dot"></span>
            Active
          </div>
        </div>
        
        <div class="sprint-meta">
          <span class="sprint-dates">
            <i class="fas fa-calendar-alt"></i>
            {{ sprint.startDate | date:'MMM d, yyyy' }} - {{ sprint.endDate | date:'MMM d, yyyy' }}
          </span>
          <span class="sprint-duration">{{ getDuration(sprint.startDate, sprint.endDate) }} days</span>
        </div>
        
        <div class="sprint-stats" *ngIf="!sprintExpanded[i]">
          <span class="stat-item">
            <i class="fas fa-tasks"></i>
            {{ sprint.taskList.length }} tasks
          </span>
          <span class="stat-item">
            <i class="fas fa-check-circle"></i>
            {{ getCompletedTasks(sprint.taskList) }} completed
          </span>
        </div>
      </div>

      <div class="sprint-actions" (click)="$event.stopPropagation()">
        <button class="btn-action btn-start" title="Start Sprint">
          <i class="fas fa-play"></i>
        </button>
        <button class="btn-action btn-menu" title="More actions">
          <i class="fas fa-ellipsis-h"></i>
        </button>
      </div>
    </div>

    <!-- Sprint Content (Collapsible) -->
    <div class="sprint-content" [class.expanded]="sprintExpanded[i]" *ngIf="sprintExpanded[i]">
      <div class="sprint-description" *ngIf="sprint.sprintDesc" [innerHTML]="sprint.sprintDesc"></div>
      
      <div class="sprint-detailed-stats">
        <div class="stat-card">
          <div class="stat-value">{{ sprint.taskList.length }}</div>
          <div class="stat-label">Total tasks</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ getCompletedTasks(sprint.taskList) }}</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ sprint.taskList.length - getCompletedTasks(sprint.taskList) }}</div>
          <div class="stat-label">Remaining</div>
        </div>
      </div>

      <!-- Sprint Tasks -->
      <div class="sprint-tasks">
        <div class="tasks-header">
          <h6>tasks in Sprint</h6>
          <button class="btn-create-task" title="Create task" (click)="createTask(sprint.sprintId)">
            <i class="fas fa-plus"></i>
            Create Task
          </button>
        </div>

        <!-- Modal Container -->
<div class="modal-container" [class.show]="isTaskModalOpen">
  <!-- Backdrop -->
  <div class="custom-backdrop"></div>
  
<!-- Modal -->
<div class="modal fade show d-block" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Assign New Task</h5>
        <button type="button" class="btn-close" (click)="isTaskModalOpen = false"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="submitTask()" [formGroup]="createTaskForm">
          <div class="row">
            <!-- Left side - Form inputs -->
            <div class="col-md-5 border-end">
              <div class="mb-3">
                <label class="form-label">Task Name</label>
                <input type="text" class="form-control" placeholder="Enter task name" formControlName="taskName">
              </div>
              <!-- <div class="mb-3">
                <label class="form-label">Project</label>
                <select class="form-select" formControlName="taskProject">
                  <option selected disabled>Select project</option>
                  <option value="webdesign" >Web Design </option>
                  <option  value="mobileComputing">Mobile Computing </option>
                </select>
              </div> -->
              <div class="mb-3">
                <label class="form-label">Assign To</label>
                <select class="form-select" formControlName="taskAssignedTo">
                  <option  *ngFor="let employee of employees" [value]="employee.eid">{{employee.ename}}</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Status</label>
                <select class="form-select" formControlName="taskStatus">
                  <option selected disabled>Select status</option>
                  <option value="todo">To Do</option>
                  <option value="todo">In Progress</option>
                  <option value="todo">Done</option>
                </select>
              </div>
            </div>
            
            <!-- Right side - Rich text editor -->
            <div class="col-md-7">
              <div class="mb-3">
                <label class="form-label">Description</label>
                <angular-editor formControlName="taskDescription" [config]="config" ></angular-editor>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="isTaskModalOpen = false">Cancel</button>
            <button type="submit" class="btn btn-primary">Create Task</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
</div>

        <div class="task-list">
          <div *ngFor="let task of sprint.taskList" class="task-item" [class.completed]="task.taskStatus === 'DONE'">
            <div class="task-type-indicator">
              <i class="fas fa-bookmark task-type-icon"></i>
            </div>
            
            <div class="task-content">
              <div class="task-header">
                <span class="task-key">{{ sprint.sprintTitle.split(' ')[0] }}-{{ task.taskId }}</span>
                <span class="task-title">{{ task.taskTitle }}</span>
              </div>
              
              <div class="task-description" *ngIf="task.taskDesc">
                {{ task.taskDesc }}
              </div>
              
              <div class="task-meta">
                <div class="task-dates">
                  <span class="created-date">Created {{ task.createdAt | date:'MMM d, yyyy' }}</span>
                  <span class="updated-date">Updated {{ task.createdAt | date:'h:mm a' }}</span>
                </div>
              </div>
            </div>

            <div class="task-right">
              <div class="task-status">
                <span class="status-badge" [class]="getStatusClass(task.taskStatus)">
                  {{ task.taskStatus }}
                </span>
              </div>
              
              <div class="task-assignee">
                <div class="avatar-circle" [title]="'Assigned to User ' + task.assignedTo">
                  {{ getInitials(task.assignedTo) }}
                </div>
              </div>
              
              <div class="task-actions">
                <button class="btn-icon" (click)="editTask(task.taskId)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-danger" (click)="deleteTask(task.taskId)" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Empty state -->
        <div *ngIf="sprint.taskList.length === 0" class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <h6>No tasks in this sprint</h6>
          <p>Create your first task to get started</p>
          <button class="btn-create-task">
            <i class="fas fa-plus"></i>
            Create task
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Backlog Section -->
  <div class="backlog-section">
    <div class="backlog-header">
      <div class="backlog-title">
        <h5>Backlog</h5>
        <span class="task-count">{{ backlogTasks?.length || 0 }} tasks</span>
      </div>
    </div>

    <div class="backlog-content">
      <div *ngFor="let task of backlogTasks" class="backlog-item">
        <div class="task-type-indicator">
          <i class="fas fa-bookmark task-type-icon"></i>
        </div>
        
        <div class="task-content">
          <div class="task-header">
            <span class="task-key">{{ task.id }}</span>
            <span class="task-title">{{ task.title }}</span>
          </div>
        </div>

        <div class="task-right">
          <div class="task-status">
            <span class="status-badge" [class]="getStatusClass(task.status)">
              {{ task.status }}
            </span>
          </div>
          
          <div class="task-assignee">
            <div class="avatar-circle" [title]="'Assigned to ' + task.assignee">
              {{ task.assignee }}
            </div>
          </div>
          
          <div class="task-actions">
            <button class="btn-icon btn-danger" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Container -->
<div class="modal-container" [class.show]="isSprintModalOpen">
  <!-- Backdrop -->
  <div class="custom-backdrop"></div>
  
  <!-- Modal -->
  <div class="modal fade show d-block" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Sprint</h5>
          <button type="button" class="btn-close" (click)="isTaskModalOpen = false"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="sprintForm" (ngSubmit)="submitSprint()">
            <div class="row">
              <!-- Left side - Form inputs -->
              <div class="col-md-5 border-end">
                <div class="mb-3">
                  <label class="form-label">Sprint Title</label>
                  <input type="text" class="form-control" formControlName="sprintTitle" placeholder="Enter Sprint Title">
                </div>
            
                <div class="mb-3">
                  <label class="form-label">Start Date</label>
                  <input type="date" class="form-control" formControlName="startDate">
                </div>

                <div class="mb-3">
                  <label class="form-label">End Date</label>
                  <input type="date" class="form-control" formControlName="endDate">
                </div>
              </div>
              
              <!-- Right side - Rich text editor -->
              <div class="col-md-7">
                <div class="mb-3">
                  <label class="form-label">Sprint Description</label>
                  <angular-editor formControlName="sprintDesc" [config]="config"></angular-editor>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Submit</button>
              <button type="button" class="btn btn-secondary" (click)="isTaskModalOpen = false">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Main Container */
.backlog-container {
  background: #f4f5f7;
  min-height: 100vh;
  padding: 24px;
}

/* Header */
.header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  background: white;
  padding: 20px 24px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.header-section h1 {
  margin: 0;
  color: #172b4d;
  font-size: 28px;
  font-weight: 600;
}

.header-actions {
  display: flex;
  gap: 16px;
  align-items: center;
}

.search-box {
  position: relative;
}

.search-box .form-control {
  width: 300px;
  padding: 10px 16px;
  border: 2px solid #dfe1e6;
  border-radius: 6px;
  background: #fafbfc;
  transition: all 0.2s;
}

.search-box .form-control:focus {
  border-color: #0052cc;
  background: white;
  outline: none;
  box-shadow: 0 0 0 3px rgba(0,82,204,0.1);
}

.btn-primary {
  background: #0052cc;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.btn-primary:hover {
  background: #0747a6;
  transform: translateY(-1px);
}

/* Sprint Container */
.sprint-container {
  background: white;
  border-radius: 8px;
  margin-bottom: 16px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  border: 1px solid #dfe1e6;
}

/* Sprint Header */
.sprint-header {
  display: flex;
  align-items: center;
  padding: 16px 20px;
  background: #f7f8f9;
  border-bottom: 1px solid #dfe1e6;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}

.sprint-header:hover {
  background: #ebecf0;
}

.sprint-header.expanded {
  background: #e4fcff;
  border-bottom-color: #00b8d9;
}

.sprint-toggle {
  margin-right: 12px;
  color: #6b778c;
  font-size: 14px;
  transition: transform 0.2s;
}

.sprint-info {
  flex: 1;
}

.sprint-title-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.sprint-title {
  margin: 0;
  color: #172b4d;
  font-size: 18px;
  font-weight: 600;
}

.sprint-status-badge {
  background: #e3fcef;
  color: #006644;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #36b37e;
}

.sprint-meta {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 8px;
}

.sprint-dates {
  display: flex;
  align-items: center;
  gap: 6px;
  color: #6b778c;
  font-size: 14px;
}

.sprint-duration {
  background: #fff4e6;
  color: #ff8b00;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.sprint-stats {
  display: flex;
  gap: 16px;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 6px;
  color: #6b778c;
  font-size: 14px;
}

.sprint-actions {
  display: flex;
  gap: 8px;
}

.btn-action {
  width: 36px;
  height: 36px;
  border: 1px solid #dfe1e6;
  border-radius: 6px;
  background: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  color: #6b778c;
}

.btn-action:hover {
  background: #f4f5f7;
  border-color: #c1c7d0;
}

.btn-start {
  background: #0052cc;
  color: white;
  border-color: #0052cc;
}

.btn-start:hover {
  background: #0747a6;
}

/* Sprint Content */
.sprint-content {
  padding: 20px 24px;
  background: white;
  border-top: 1px solid #dfe1e6;
}

.sprint-description {
  margin-bottom: 20px;
  padding: 16px;
  background: #f7f8f9;
  border-radius: 6px;
  color: #6b778c;
  line-height: 1.5;
}

.sprint-detailed-stats {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: #f7f8f9;
  padding: 16px;
  border-radius: 6px;
  text-align: center;
  flex: 1;
}

.stat-value {
  font-size: 24px;
  font-weight: 600;
  color: #172b4d;
}

.stat-label {
  font-size: 12px;
  color: #6b778c;
  margin-top: 4px;
  text-transform: uppercase;
}

.tasks-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.tasks-header h6 {
  margin: 0;
  color: #172b4d;
  font-size: 16px;
  font-weight: 600;
}

.btn-create-task {
  background: #0052cc;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s;
}

.btn-create-task:hover {
  background: #0747a6;
}

/* Task Items */
.task-item, .backlog-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border: 1px solid #dfe1e6;
  border-radius: 6px;
  background: white;
  margin-bottom: 8px;
  transition: all 0.2s;
}

.task-item:hover, .backlog-item:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border-color: #c1c7d0;
}

.task-item.completed {
  background: #f8fff8;
  border-color: #36b37e;
}

.task-type-indicator {
  width: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.task-type-icon {
  color: #0052cc;
  font-size: 14px;
}

.task-content {
  flex: 1;
}

.task-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 4px;
}

.task-key {
  color: #6b778c;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

.task-title {
  color: #172b4d;
  font-size: 14px;
  font-weight: 500;
}

.task-description {
  color: #6b778c;
  font-size: 13px;
  line-height: 1.4;
  margin-bottom: 8px;
}

.task-meta {
  display: flex;
  gap: 16px;
}

.task-dates {
  display: flex;
  gap: 12px;
  font-size: 11px;
  color: #6b778c;
}

.task-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  border: 1px solid;
    text-align: center;

}

.status-badge.todo {
  background: #f4f5f7;
  color: #6b778c;
  border-color: #c1c7d0;
}

.status-badge.progress {
  background: #fff4e6;
  color: #ff8b00;
  border-color: #ff8b00;
  text-align: center;
  width: auto;
  height: auto;
  
}

.status-badge.done {
  background: #e3fcef;
  color: #006644;
  border-color: #36b37e;
}

.avatar-circle {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #0052cc;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 600;
}

.task-actions {
  display: flex;
  gap: 4px;
}

.btn-icon {
  width: 32px;
  height: 32px;
  border: none;
  background: none;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b778c;
  transition: all 0.2s;
}

.btn-icon:hover {
  background: #f4f5f7;
}

.btn-icon.btn-danger:hover {
  background: #ffebe6;
  color: #de350b;
}

/* Backlog Section */
.backlog-section {
  background: white;
  border-radius: 8px;
  margin-top: 24px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  border: 1px solid #dfe1e6;
}

.backlog-header {
  padding: 16px 20px;
  background: #f7f8f9;
  border-bottom: 1px solid #dfe1e6;
}

.backlog-title {
  display: flex;
  align-items: center;
  gap: 12px;
}

.backlog-title h5 {
  margin: 0;
  color: #172b4d;
  font-size: 18px;
  font-weight: 600;
}

.task-count {
  background: #c1c7d0;
  color: #172b4d;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.backlog-content {
  padding: 16px 20px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: #6b778c;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  color: #c1c7d0;
}

.empty-state h6 {
  margin: 0 0 8px 0;
  color: #172b4d;
  font-size: 16px;
}

.empty-state p {
  margin: 0 0 20px 0;
  font-size: 14px;
}

/* Modal Styles */
.modal-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1050;
  display: none;
}

.modal-container.show {
  display: block;
}

.custom-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1040;
}

.modal-content {
  border-radius: 8px;
  border: none;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
}

.modal-header {
  background: #f7f8f9;
  border-bottom: 1px solid #dfe1e6;
  padding: 20px 24px;
}

.modal-title {
  color: #172b4d;
  font-size: 18px;
  font-weight: 600;
  margin: 0;
}

.modal-body {
  padding: 24px;
}

.form-label {
  color: #172b4d;
  font-weight: 600;
  margin-bottom: 8px;
}

.form-control {
  border: 2px solid #dfe1e6;
  border-radius: 6px;
  padding: 10px 12px;
  transition: all 0.2s;
}

.form-control:focus {
  border-color: #0052cc;
  box-shadow: 0 0 0 3px rgba(0,82,204,0.1);
  outline: none;
}

.btn-success {
  background: #36b37e;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
}

.btn-success:hover {
  background: #00875a;
}

.btn-secondary {
  background: #f4f5f7;
  border: 1px solid #dfe1e6;
  color: #6b778c;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
}

.btn-secondary:hover {
  background: #e4e6ea;
}
</style>